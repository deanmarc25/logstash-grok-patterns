# Syslog stuff
COMPONENT ([\w._\/%-]+)
COMPID postfix\/%{COMPONENT:postfix_component}(?:\[%{POSINT:postfix_pid}\])?
POSTFIX %{SYSLOGTIMESTAMP:postfix_timestamp} %{SYSLOGHOST:postfix_hostname} %{COMPID}: %{QUEUEID:postfix_queueid}

# Milter
HELO (?:\[%{IP:postfix_helo}\]|%{HOST:postfix_helo}|%{DATA:postfix_helo})

MILTERCONNECT %{QUEUEID:postfix_qid}: milter-reject: CONNECT from %{RELAY:postfix_relay}: %{GREEDYDATA:postfix_milter_reason}; proto=%{WORD:postfix_proto}
MILTERUNKNOWN %{QUEUEID:postfix_qid}: milter-reject: UNKNOWN from %{RELAY:postfix_relay}: %{GREEDYDATA:postfix_milter_reason}; proto=%{WORD:postfix_proto}
MILTEREHLO %{QUEUEID:postfix_qid}: milter-reject: EHLO from %{RELAY:postfix_relay}: %{GREEDYDATA:postfix_milter_reason}; proto=%{WORD:postfix_proto} helo=<%{HELO}>
MILTERMAIL %{QUEUEID:postfix_qid}: milter-reject: MAIL from %{RELAY:postfix_relay}: %{GREEDYDATA:postfix_milter_reason}; from=<%{EMAILADDRESS:postfix_from}> proto=%{WORD:postfix_proto} helo=<%{HELO}>
MILTERHELO %{QUEUEID:postfix_qid}: milter-reject: HELO from %{RELAY:postfix_relay}: %{GREEDYDATA:postfix_milter_reason}; proto=%{WORD:postfix_proto} helo=<%{HELO}>
MILTERRCPT %{QUEUEID:postfix_qid}: milter-reject: RCPT from %{RELAY:postfix_relay}: %{GREEDYDATA:postfix_milter_reason}; from=<%{EMAILADDRESS:postfix_from}> to=<%{EMAILADDRESS:postfix_to}> proto=%{WORD:postfix_proto} helo=<%{HELO}>
MILTERENDOFMESSAGE %{QUEUEID:postfix_qid}: milter-reject: END-OF-MESSAGE from %{RELAY:postfix_relay}: %{GREEDYDATA:postfix_milter_reason}; from=<%{EMAILADDRESS:postfix_from}> to=<%{EMAILADDRESS:postfix_to}> proto=%{WORD:postfix_proto} helo=<%{HELO}>

# Postfix stuff
QUEUEID (?:[A-F0-9]+|NOQUEUE)
EMAILADDRESSPART [a-zA-Z0-9_.+-=:]+
EMAILADDRESS %{EMAILADDRESSPART:postfix_local}@%{EMAILADDRESSPART:postfix_remote}

#tykhax
IPRELAY (?:%{HOSTNAME:postfix_relayhost}(?:\[%{IP:postfix_relayip}\](?::[0-9]+(.[0-9]+)?)?)?)
LMTPRELAY %{IPORHOST:postfix_relayhost}\[%{DATA:postfix_relaytype}/%{DATA:postfix_relaymethod}\]
RELAYRELAY (?:%{LMTPRELAY}|%{IPRELAY})
POSTFIX_DELAYS %{NUMBER:postfix_delay_before_qmgr}/%{NUMBER:postfix_delay_in_qmgr}/%{NUMBER:postfix_delay_conn_setup}/%{NUMBER:postfix_delay_transmission}
POSTFIX_DELAY %{NUMBER:postfix_delay}

RELAY (?:%{HOSTNAME:postfix_relayhost}(?:\[%{IP:postfix_relayip}\](?::[0-9]+(.[0-9]+)?)?)?)
POSREAL [0-9]+(.[0-9]+)?
DSN %{NONNEGINT}.%{NONNEGINT}.%{NONNEGINT}
STATUS sent|deferred|bounced|expired
PERMERROR 5[0-9]{2}
MESSAGELEVEL reject|warning|error|fatal|panic

POSTFIXSMTPMESSAGE %{MESSAGELEVEL}: %{GREEDYDATA:postfix_reason}
POSTFIXACTION discard|dunno|filter|hold|ignore|info|prepend|redirect|replace|reject|warn

# postfix/smtp and postfix/lmtp, postfix/local and postfix/error
POSTFIXSMTP %{POSTFIXSMTPRELAY}|%{POSTFIXSMTPCONNECT}|%{POSTFIXSMTP5XX}|%{POSTFIXSMTPREFUSAL}|%{POSTFIXSMTPLOSTCONNECTION}|%{POSTFIXSMTPTIMEOUT}
POSTFIXSMTPRELAY %{QUEUEID:postfix_qid}: to=<%{EMAILADDRESS:postfix_to}>,(?:\sorig_to=<%{EMAILADDRESS:postfix_orig_to}>,)? relay=%{RELAYRELAY}, delay=%{POSTFIX_DELAY}, delays=%{POSTFIX_DELAYS}, dsn=%{DSN:postfix_dsn}, status=%{STATUS:postfix_result} %{GREEDYDATA:postfix_reason}
#POSTFIXSMTPRELAY %{QUEUEID:postfix_qid}: to=<%{EMAILADDRESS:postfix_to}>,(?:\sorig_to=<%{EMAILADDRESS:postfix_orig_to}>,)? relay=%{RELAY},(?: conn_use=%{POSREAL:conn_use},)? (%{WORD}=%{DATA},)+ dsn=%{DSN:postfix_dsn}, status=%{STATUS:postfix_result} %{GREEDYDATA:postfix_reason}
POSTFIXSMTPCONNECT connect to %{RELAY}: %{GREEDYDATA:postfix_reason}
POSTFIXSMTP5XX %{QUEUEID:postfix_qid}: to=<%{EMAILADDRESS:postfix_to}>,(?:\sorig_to=<%{EMAILADDRESS:postfix_orig_to}>,)? relay=%{RELAY}, (%{WORD}=%{DATA},)+ dsn=%{DSN:postfix_dsn}, status=%{STATUS:postfix_result} \(host %{HOSTNAME}\[%{IP}\] said: %{PERMERROR:postfix_responsecode} %{DATA:postfix_smtp_response} \(in reply to %{DATA:postfix_command} command\)\)
POSTFIXSMTPREFUSAL %{QUEUEID:postfix_qid}: host %{RELAY} refused to talk to me: %{GREEDYDATA:postfix_reason}
POSTFIXSMTPLOSTCONNECTION %{QUEUEID:postfix_qid}: lost connection with %{RELAY} while %{GREEDYDATA:postfix_reason}
POSTFIXSMTPTIMEOUT %{QUEUEID:postfix_qid}: conversation with %{RELAY} timed out while %{GREEDYDATA:postfix_reason}


# postfix/smtpd
POSTFIXSMTPD %{POSTFIXSMTPDCONNECTS}|%{POSTFIXSMTPDMILTER}|%{POSTFIXSMTPDACTIONS}|%{POSTFIXSMTPDTIMEOUTS}|%{POSTFIXSMTPDLOGIN}|%{POSTFIXSMTPDCLIENT}|%{POSTFIXSMTPDNOQUEUE}|%{POSTFIXSMTPDWARNING}|%{POSTFIXSMTPDLOSTCONNECTION}
POSTFIXSMTPDCONNECTS (?:dis)?connect from %{RELAY}
POSTFIXSMTPDMILTER %{MILTERCONNECT}|%{MILTERUNKNOWN}|%{MILTEREHLO}|%{MILTERMAIL}|%{MILTERHELO}|%{MILTERRCPT}
POSTFIXSMTPDACTIONS %{QUEUEID:postfix_qid}: %{POSTFIXACTION:postfix_action}: %{DATA:postfix_command} from %{RELAY}: %{PERMERROR:postfix_responsecode} %{DSN:postfix_dsn} %{DATA}: %{DATA:postfix_reason}; from=<%{EMAILADDRESS:postfix_from}> to=<%{EMAILADDRESS:postfix_to}> proto=%{DATA:postfix_proto} helo=<%{HELO}>
#POSTFIXSMTPDACTIONS %{QUEUEID:postfix_qid}: %{POSTFIXACTION:postfix_action}: %{DATA:postfix_command} from %{RELAY}: %{DATA:postfix_smtp_response}: %{DATA:postfix_reason}; from=<%{EMAILADDRESS:postfix_from}> to=<%{EMAILADDRESS:postfix_to}> proto=%{DATA:postfix_proto} helo=<%{HELO}>
POSTFIXSMTPDTIMEOUTS timeout after %{DATA:postfix_command} from %{RELAY}
POSTFIXSMTPDLOGIN %{QUEUEID:postfix_qid}: client=%{DATA:postfix_client}, sasl_method=%{DATA:postfix_saslmethod}, sasl_username=%{GREEDYDATA:postfix_saslusername}
POSTFIXSMTPDCLIENT %{QUEUEID:postfix_qid}: client=%{GREEDYDATA:postfix_client}
POSTFIXSMTPDNOQUEUE NOQUEUE: %{POSTFIXACTION:postfix_action}: %{DATA:postfix_command} from %{RELAY}: %{GREEDYDATA:postfix_reason}
POSTFIXSMTPDWARNING warning: %{IP}: %{GREEDYDATA:postfix_reason}
POSTFIXSMTPDLOSTCONNECTION lost connection after %{DATA:postfix_smtp_response} from %{RELAY}

# postfix/cleanup
POSTFIXCLEANUP %{POSTFIXCLEANUPMESSAGE}|%{POSTFIXCLEANUPMILTER}
POSTFIXCLEANUPMESSAGE %{QUEUEID:postfix_qid}: (resent-)?message-id=<%{GREEDYDATA:postfix_messageid}>
POSTFIXCLEANUPMILTER %{MILTERENDOFMESSAGE}

# postfix/bounce
POSTFIXBOUNCE %{QUEUEID:postfix_qid}: sender non-delivery notification: %{QUEUEID:postfix_bouncequeueid}

# postfix/qmgr and postfix/pickup
POSTFIXQMGR %{QUEUEID:postfix_qid}: (?:removed|from=<(?:%{EMAILADDRESS:postfix_from})?>(?:, size=%{POSINT:postfix_size}, nrcpt=%{POSINT:postfix_nrcpt} \(%{GREEDYDATA:postfix_queuestatus}\))?)

# postfix/anvil
POSTFIXANVIL statistics: %{DATA:postfix_anvilstatistic} for (%{DATA:postfix_remotehost}) at %{SYSLOGTIMESTAMP:postfix_timestamp}

# warnings
POSTFIXWARNING warning: %{GREEDYDATA:warningtext}

# put it all together
PF (%{POSTFIXSMTP}|%{POSTFIXANVIL}|%{POSTFIXQMGR}|%{POSTFIXBOUNCE}|%{POSTFIXCLEANUP}|%{POSTFIXSMTPD}|%{POSTFIXWARNING})

